<div class="content-header">
    <h1>Edição da CPU</h1><small>Edição dos dados e itens da CPU</small>   
</div>

<br>

<div class="col-md-12" *ngIf="alertas">
    <div class="box box-success">
        <div class="box-header with-border">
            <h5 class="box-title">Informações salvas com sucesso!</h5>
            <div class="box-tools pull-right">
                <button class="btn btn-box-tool" (click)="fecharAlerta()"><i class="fa fa-times"></i></button>
            </div>
        </div>
    </div>
</div>

<div class="col-md-12"><!-- Dados básicos da CPU -->
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title"><i class="fa fa-info-circle"></i> Dados Gerais</h3>
            <a class="btn btn-warning btn-xs pull-right" *ngIf="id != null" role="button" (click)="atualizarCpu()"><i class="fa fa-plus-circle"></i> Atualizar</a>
            <a class="btn btn-warning btn-xs pull-right" *ngIf="id == null" role="button" (click)="inserirCpu()"><i class="fa fa-plus-circle"></i> Adicionar</a>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <form #form="ngForm" novalidate >
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="id">Código</label>
                            <input type="text" class="form-control text-center" [readonly]="id == null" name="id" placeholder="Código" [(ngModel)]="cpus.id" />
                        </div>
                    </div>
                    <div class="col-md-10">
                        <div class="form-group">
                            <label for="descricao">Descrição</label>
                            <textarea type="text" class="form-control" name="descricao" [(ngModel)]="cpus.descricao" placeholder="Descrição do material / serviço"></textarea>
                        </div>
                    </div>
                </div><!-- /Final da linha -->
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="unidade">Unidade</label>
                            <input type="text" class="form-control text-center" name="unidade" [(ngModel)]="cpus.unidade" placeholder="Unidade"/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="cst_mo">Preço Mão de Obra</label>
                            <input type="text" class="form-control text-right" name="cst_mo" [ngModel]="cpus.cst_mo  | currency:'BRL' : true" placeholder="Custo da mão de obra" readonly/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="cst_mo">Encargos</label>
                            <input type="text" class="form-control text-right" name="cst_encargos" [ngModel]="cpus.cst_encargos  | currency:'BRL' : true" placeholder="Custo da mão de obra" readonly/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="cst_outros">Preço Outros</label>
                            <input type="text" class="form-control text-right" name="cst_outros" [ngModel]="cpus.cst_outros  | currency:'BRL' : true" placeholder="Outros custos" readonly/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="cst_outros">BDI</label>
                            <input type="text" class="form-control text-right" name="cst_bdi" [ngModel]="cpus.cst_bdi  | currency:'BRL' : true" placeholder="Outros custos" readonly/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="cst_total">Preço Total</label>
                            <input type="text" class="form-control text-right" name="cst_total" [ngModel]="cpus.cst_total  | currency:'BRL' : true"  placeholder="Custo total do serviço" readonly/>
                        </div>
                    </div>
                </div>
            </form>
        </div><!-- /Relação de Solicitações -->
    </div>
</div><!-- /Dados básicos da CPU -->

<div class="col-md-12"><!-- Lista de itens da CPU -->
    <!-- Relação de Solicitações -->
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title"><i class="fa fa-list"></i> Lista de Insumos e Serviços</h3>
            <a class="btn btn-primary btn-xs pull-right" role="button" (click)="showModalAddItem()"><i class="fa fa-plus-circle"></i> Adicionar</a> 
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <table class="table table-bordered">
                <tr>
                    <th class="text-center" style="min-width: 15px; width: 5%">Código</th>
                    <th class="text-center">Descrição do Insumo</th>
                    <th class="text-center" style="min-width: 15px; width: 8%">Unidade</th>
                    <th class="text-center">Tipo</th>
                    <th class="text-center" width="10%">Quantidade</th>
                    <th class="text-center" width="10%">P. Unitário</th>
                    <th class="text-center" width="10%">P. Total</th>
                </tr>
                <tr *ngFor="let item of cpus.itens ; let i = index">
                    <td class="text-center">{{ item.insumos_id }}</td>
                    <td>
                        {{ item.descricao }}
                        <a class="text-danger pull-right space-right" (click)="deletarInsumo(i)" role="button"><i class="fa fa-trash"></i></a> 
                        <span *ngIf="item.status == 2" class="label label-danger pull-right space-right" (click)="deletarInsumo(i)" >Excluido</span>
                        <span *ngIf="item.status == 3" class="label label-primary pull-right space-right">Novo</span>
                        <span *ngIf="item.status == 1" class="label label-success pull-right space-right">Modificado</span>
                    </td>
                    <td class="text-center">{{ item.unidade }}</td>
                    <td class="text-center">{{ item.tipo }}</td>
                    <td class="text-right"><input type="text" class="input-container-hidden text-right" [(ngModel)]="item.quantidade"/></td>
                    <td class="text-right">{{ item.cst_total  | currency:'BRL' : true }}</td>
                    <td class="text-right">{{ ((item.status == 2) ? 0 : 1) * (item.cst_total * item.quantidade).toFixed(2) | currency:'BRL' : true }}</td>
                </tr>
            </table>
        </div><!-- /Relação de Solicitações -->
    </div>
</div><!-- /Lista de itens da CPU -->

<!-- Modal de acréscimo de item -->
<app-add-item-modal
        [mostrarDialog]="modalAddItemStatus" 
        (onCancel)="hideModalAddItem()" 
        (onNewItem)="addNewItem($event)">
</app-add-item-modal>